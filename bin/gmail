#!/bin/bash

RED=$(tput bold)$(tput setaf 1)
GREEN=$(tput bold)$(tput setaf 2)
YELLOW=$(tput bold)$(tput setaf 3)
BLUE=$(tput bold)$(tput setaf 4)
NORMAL=$(tput sgr0)

passwords=( $( cat ~/.gmail ) )

function get {
  echo "${RED}$1"
  printf %${#1}s |tr " " "="
  echo "${NORMAL}"
  curl -u $1:$2 --silent "https://mail.google.com/mail/feed/atom" | \
    perl -ne \
      'print "\n" if /<title>/ and !/Gmail - Inbox/; \
      print "    " if /<name>/; \
      print "  " if /<summary>/; \
      print "'${GREEN}'$2'${NORMAL}'\n" if /<(title)>(.*)<\/\1>/ and !/Gmail - Inbox/; \
      print "'${YELLOW}'$2'${NORMAL}'\n" if /<(summary)>(.*)<\/\1>/; \
      print "'${BLUE}'$2'${NORMAL}'\n" if /<(name)>(.*)<\/\1>/;' | \
    sed "s/&#39;/'/g" | \
    sed "s/&lt;/</g" | \
    sed "s/&gt;/>/g" | \
    sed "s/&amp;/\&/g"
}

# Clear the screen
echo;echo;echo;echo;echo;echo;echo;echo;
echo;echo;echo;echo;echo;echo;echo;echo;
echo;echo;echo;echo;echo;echo;echo;echo;
echo;echo;echo;echo;echo;echo;echo;echo;
echo;echo;echo;echo;echo;echo;echo;echo;
echo;echo;echo;echo;echo;echo;echo;echo;
echo;echo;echo;echo;echo;echo;echo;echo;
echo;echo;echo;echo;echo;echo;echo;echo;

get ${passwords[0]} ${passwords[1]}
echo
echo "-------------------------------"
echo
get ${passwords[2]} ${passwords[3]}
